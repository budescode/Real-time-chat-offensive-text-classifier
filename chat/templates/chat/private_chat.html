{% extends "base.html" %}
{% block title %}Chat with {{ other_user.username }}{% endblock %}
{% block content %}
<h3>Chat with {{ other_user.username }}</h3>
<div id="chat-box" style="height:300px;overflow-y:auto;border:1px solid #ccc;padding:10px;">
  {% for message in messages %}
    <p><strong>{{ message.sender.username }}:</strong> {{ message.content }}</p>
  {% endfor %}
</div>

<form id="chat-form">
  <input type="text" id="message-input" placeholder="Type message..." class="form-control">
  <button type="submit" class="btn btn-success mt-2">Send</button>
</form>

<script>
  const roomName = "{{ other_user.username }}";
  const chatSocket = new WebSocket(
    "ws://" + window.location.host + "/ws/chat/{{ other_user.username }}/"
  );

  chatSocket.onmessage = function(e) {
    const data = JSON.parse(e.data);
    document.querySelector("#chat-box").innerHTML += "<p><strong>" + data.sender + ":</strong> " + data.message + "</p>";
  };

  document.querySelector("#chat-form").onsubmit = function(e) {
    e.preventDefault();
    const messageInput = document.querySelector("#message-input");
    chatSocket.send(JSON.stringify({
      "message": messageInput.value
    }));
    messageInput.value = "";
  };
</script>
{% endblock %}
